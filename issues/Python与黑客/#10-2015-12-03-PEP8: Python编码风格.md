[LeslieZhu](https://github.com/LeslieZhu) on 2015-12-03:


- 原文链接: [PEP 0008 -- Style Guide for Python Code](https://www.python.org/dev/peps/pep-0008/)

# PEP8: Python代码风格

从Python官方文档中翻译、整理的一个笔记，是Python代码风格方面的约定。



# 蛮目的追求一致性是误入魔道

Guido认为在程序开发中，大部分时间是花在看代码上，因此可读性非常重要。

制定风格指南是为了一致性，一致的编码风格是重要的，一致的项目风格是重要的，一致的模块或函数风格就更加重要。

但更重要的是知道什么时候不保持一致：当风格指南变得不适用的时候。当犹豫不决时，听从你的判断力，看看其它代码然后决定怎么样做看起来更好。不要羞于提问。

原则上来讲，不要为了使用PEP8风格指南而忽略向后兼容性。

但有时候出于下列原因可以不遵循这个指南:

- 哪怕根据PEP8来阅读代码，适用指南还是会减低代码可读性
- 为了和其它没有遵循此指南的代码保持一致（可能是历史原因），但这也是清除烂代码的时候（根据敏捷开发风格）
- 很久远的代码，旧到那会儿还没有PEP8，也没有其它的原因去改动代码
- 但代码需要和旧版本的Python保持兼容，低版本的Python可能不支持PEP8风格中的某些特性

# 代码排版

## 缩进

使用4个空格缩来表示缩进。

连续的代码行应该保持一样的缩进，不管是使用Python语句中的中括号、圆括号，还是悬挂缩进。当使用悬挂缩进的时候，在第一行不要包含参数，而缩进要能够明确的区分每行内容。

正确:

```python
# 和开始的中括号对齐
foo = long_function_name(var_one, var_two,
                         var_three, var_four)

# 增加缩进以和其它代码区分开来
def long_function_name(
        var_one, var_two, var_three,
        var_four):
    print(var_one)

# 悬挂缩进要增加一个缩进级别
foo = long_function_name(
        var_one, var_two,
        var_three, var_four)
```

错误:

```python
# 没有对齐
foo = long_function_name(var_one, var_two,
    var_three, var_four)

# 缩进不够
def long_function_name(
    var_one, var_two, var_three,
    var_four):
    print(var_one)
```

4个空格表示一级缩进的规定是可以灵活使用的:

```python
# 这种缩进可能不一定需要使用4个空格
foo = long_function_name(
  var_one, var_two,
  var_three, var_four)
 ```

当if语句长到需要跨行的时候，没有必要改成两个if语句，增加一个空格，增加一个开括号，然后下一行保持缩进即可:

```python
# 没有额外的缩进
if (this_is_one_thing and
    that_is_another_thing):
    do_something()

# 增加一条注释，在某些编辑器会语法高亮，从而起到区分作用
if (this_is_one_thing and
    that_is_another_thing):
    # Since both conditions are true, we can frobnicate.
    do_something()

# 增加一些缩进
if (this_is_one_thing
        and that_is_another_thing):
    do_something()
```

代码块结束符如中括号、圆括号等在多行代码的情况下，可以和上一行第一个非空白字符保持缩进:

```python
my_list = [
    1, 2, 3,
    4, 5, 6,
    ]
result = some_function_that_takes_arguments(
    'a', 'b', 'c',
    'd', 'e', 'f',
    )
```

也可以直接和上一行第一个字符保持缩进:

```python
my_list = [
    1, 2, 3,
    4, 5, 6,
]
result = some_function_that_takes_arguments(
    'a', 'b', 'c',
    'd', 'e', 'f',
)
```

## 制表符vs空格

推荐使用空格表示缩进。

只有当之前使用了制表符，为了保持统一的缩进而不得不使用制表符的时候才使用制表符，能不用就不要用。

在Python 3不允许混用空格和制表符。

在Python 2中混用了空格和制表符的应该换成只使用空格来表示缩进。

在Python 2与命令行中执行时，加上-t参数，会警告混用了制表符与空格的情况，如果使用-tt参数则变成错误看待。强烈推荐使用！


## 行最大长度

行最大长度不要超过79个字符。

对于大段的包含一定结构的字符串（文档字符串或注释），行的长度不要超过72个字符。

限制长度可以让编辑器同时打开多个文件，方便一一对照来查看、比较多个版本的代码。

如果要使用很长的行，则推荐使用`\`来连接:

```python
with open('/path/to/some/file/you/want/to/read') as file_1, \
     open('/path/to/some/file/being/written', 'w') as file_2:
    file_2.write(file_1.read())
```

也可以在操作符后面断行，但要保持缩进:

```python
class Rectangle(Blob):

    def __init__(self, width, height,
                 color='black', emphasis=None, highlight=0):
        if (width == 0 and height == 0 and
                color == 'red' and emphasis == 'strong' or
                highlight > 100):
            raise ValueError("sorry, you lose")
        if width == 0 and height == 0 and (color == 'red' or
                                           emphasis is None):
            raise ValueError("I don't think so -- values are %s, %s" %
                             (width, height))
        Blob.__init__(self, width, height,
                      color, emphasis, highlight)
```

## 空行

顶级函数和类定义前后应该留2个空行。

在类里面的函数定义之间保留1个空行。

可以多加1个空行来分隔一组相关函数。而对于一堆只有1行的内容之间，有时可以省去空行分隔。

在函数里可以适当的添加空行来组织逻辑。

Python支持特殊字符Crtl-L(^L)，一些工具会把这些字符看做分页符，因此可以在文件中把这些字符当作分页符使用。但有些编辑器或基于web的阅读器并不会`^L`看成特殊字符，而是直接显示这个字符。


## 源文件编码格式

Python发行版核心代码一般都是UTF-8编码(Python 2使用ASCII).

源文件在Python 2中使用ASCII或在Python 3中使用UTF-8应该不会遇到编码问题。

在标准库中，不是使用默认编码格式的应该只用于测试或者注释/文档的作者名字包含非ASCII字符。总之，在字符串中包含非ASCII码最好使用在前面添加`\x`,`\u`,`\U`,`\N`的方式.

从Python 3.0之后，标准库要符合下列要求(参考 PEP 3131):

- 所有标识符必须只包含ASCII字符，并且应该尽量使用英文单词（有时，有些缩写或技术术语并非使用英文）
- 尽量保持字符串、注释使用ASCII，例外情况包括:
   - 测试用例需要测试到和非ASCII有关的功能
   - 作者名字包含了非拉丁字符

开源项目的受众是全球的开发人员，应该也遵守这些条款。

## 导入(import)

导入时应该一行一行的分开，如:

正确做法:

```python
import os
import sys
```

错误做法:

```python
import sys, os
```

但这样做是可以的:

```python
from subprocess import Popen, PIPE
```

导入部分代码应该总是在源文件的前几行，紧跟在模块注释或文档之后，在模块全局变量、声明之前。

导入部分应该按照下列顺序分组导入:

- 导入标准库
- 导入相关第三方库
- 导入本地程序/库

在每组之间应该用一个空行分割.

在导入部分代码后面，紧跟着指定 `__all__` 。

建议使用绝对路径导入，这样有更好的可读性，同时在导入操作出问题时更好定位问题根源:

```python
import mypkg.sibling
from mypkg import sibling
from mypkg.sibling import example
```

当然，使用相对路径导入也是可以接受的，尤其是当软件包文件结构很复杂的时候，使用绝对路径导入显得没有必要:

```python
from . import sibling
from .sibling import example
```

标准库的代码应该避免过于复杂的包文件结构，总是使用绝对路径导入。

在Python 3中已经不支持相对路径导入了，因此，不要使用相对路径导入.

但从一个包含类的模块中导入一个类，一般可以这样:

```python
from myclass import MyClass
from foo.bar.yourclass import YourClass
```

如果这样会导致本地变量名混淆，则可以这样:

```python
import myclass
import foo.bar.yourclass
```

然后使用 `myclass.MyClass` 和 `foo.bar.yourclass.YourClass` 来调用。

尽量避免一股脑的全导入(`from <module> import *`)，这样无法知晓到底哪些导入到了名字空间，减低了可读性，也导致一些自动化工具无法工作。有一种情况下可以使用全部导入，就是要把内部结构当作外部公共API的时候。

即使是一股脑全部导入的方式，此文档后续部分依旧适用于公共、内部接口。


# 字符串引号

在Python语言中，单引号和双引号是一样的，但一个字符串中已经有单引号或双引号时，可以使用另一个来避免转义字符，这样可以增加可读性。

对于一大段字符串，建议使用双引号来作为**文档字符串**，参阅 PEP 257.

